<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Use correct character set. -->
    <meta charset="utf-8">
    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title id="title">Stinuum Example</title>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <!-- bootstarp -->
    <script src="lib/bootstrap.min.js"></script>
    <link type="text/css" href="lib/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.7.2/bootstrap-slider.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.7.2/css/bootstrap-slider.css" />

    <!-- d3 -->
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <!-- cesium -->
    <script type="text/javascript" src="../../Apps/Sandcastle/Sandcastle-header.js"></script>
    <script src="../../Build/Cesium/Cesium.js"></script>

    <!-- Stinuum -->
    <script src="../stinuum.js"></script>
    <script src="buffer.js"></script>
    <script src="connection.js"></script>
    <script src="fileio.js"></script>
    <script src="temporal_property.js"></script>
    <script src="print.js"></script>
    <script src="local.js"></script>
    <script src="analysis.js"></script>
    <link rel="stylesheet" type="text/css" href="demo_style.css">
    <link rel="stylesheet" type="text/css" href="bs.css">
    <style>

    </style>
</head>

<body style="margin-bottom:20%">
    <div id="left_toolbar_btn" onclick="toggle_toolbar()"> < </div>
    <div id="upper_toolbar" class="upper_toolbar" style="display:flex">
        <div id="graph_btn" class="upper_toolbar_btn" onclick="selectProperty('graph')"> GRAPH </div>
        <div id="occurrence_btn" class="upper_toolbar_btn"> OCCURENCE </div>
        <div id="st_query_btn" class="upper_toolbar_btn" onclick="spatio_query()"> ST_QUERY </div>
        <div id="t_query_btn" class="upper_toolbar_btn" onclick="time_query()"> T_QUERY </div>
        <div id="radar_btn" class="upper_toolbar_btn"> RADAR </div>
    </div>
    <div id="option" class="upper_toolbar" style="display:none"></div>
    <div id="left_toolbar">
        <div class="left_toolbar_div panel-default" style="z-index:3 ;   height : 70%; min-height : 70%; ">
            <ul id="menu_list" class="list-group" >
                <li onclick="backButton()" style="padding : 10px;flex-grow : 0; background : white ; color : black ;text-align: center; cursor :pointer;">Back</li>
                <li id = "uploadButton" ></li>

                <li id="printMenuState" role="presentation" class="list-group-item active list-title" style="flex-grow : 0;"></li>
                <li id="featureLayer" role="presentation" style="margin-top: 15px; flex-grow : 1 ; overflow : auto">

                </li>
            </ul>

        </div>

        <div id="layer_list" class="left_toolbar_div panel-default" style="overflow : auto">
            <ul>
                <li id="printedLayerListMenu" role="presentation" class="list-title">printed Layers List</li>
                <li id="list">

                </li>

            </ul>
        </div>
        <div id="property_panel" class="left_toolbar_div panel-default" style="overflow : auto">

            <ul>
                <li role="presentation" class="list-title">Properties</li>
                <li role="presentation">
                    <ul id="property" role="presentation">

                    </ul>
                </li>
            </ul>

        </div>




    </div>

    <div id="drop_zone_bg">
        <div id="drop_zone_close" onclick="closeDrop()"> <span style = "display: table-cell;  vertical-align: middle;"> CLOSE </span> </div>
        <div id="drop_zone">
            <span style = "display: table-cell;  vertical-align: middle;">DROP FILES HERE</span>
        </div>
    </div>

    <div id="graph" class="graph">
    </div>

    <div id="cesiumContainer">

    </div>
</br><!--
 <div id="zoom">
<a id="min-date" style="white-space: nowrap; align:right; float : center; font-size:small"></a>
<input id="slider" type="text"/>  
</br>
</br>
<a id="max-date" style="white-space: nowrap; align:right;  float : center; font-size:small"></a>
</br>

</div>
-->
<div id="featureName"></div>
<div id="context">
</div>
<div id="serverState">
</div>


<script>
var properties = new Array();
var checked_property = new Array();
var features = new Array();
var feature = new Array();
var viewer;
var stinuum;
var labelEntity;
var handler;
var labelEntity;
var slider;
var label_timeout;
var toolbar_show = true;
var div_id = {
    'graph' : 'graph',
    "radar" : 'radar',
    "option" : "option",
    "upper_toolbar" : "upper_toolbar"
};

(function() {
    viewer = new Cesium.Viewer('cesiumContainer', {
        orderIndependentTranslucency: false,
        baseLayerPicker: true
    });

    viewer.scene.fxaa = false;

    stinuum = new Stinuum(viewer);
    viewer.scene.mode = Cesium.SceneMode.SCENE2D;

    viewer.scene.morphComplete.addEventListener(function() {
        refresh();
        clearAnalysis();
        if (viewer.scene.mode == Cesium.SceneMode.COLUMBUS_VIEW) {
            stinuum.changeMode('SPACETIME');
        } else if (viewer.scene.mode == Cesium.SceneMode.SCENE2D){
            stinuum.changeMode('STATICMAP');
        } else if (viewer.scene.mode == Cesium.SceneMode.SCENE3D){
            stinuum.changeMode('ANIMATEDMAP');
        } else {
            alert('error');
        }
        
    });



    scene = viewer.scene;
    viewer.clock.shouldAnimate = false;

    handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);
    this.handler.setInputAction(function(movement) {
        var featureName = document.getElementById('featureName');
        if(label_timeout !== undefined){
            window.clearTimeout(label_timeout);
        }
        var pick = scene.pick(movement.position);
        if (Cesium.defined(pick)) {
            featureName.innerText = "";
            if(pick.primitive.id !== undefined){
                stinuum.geometryViewer.clickMovingFeature(pick.primitive.id);
                var cesiumContainer = document.getElementById('cesiumContainer');
                featureName.innerText = pick.primitive.id;
                featureName.style.visibility = 'visible';

                showContextMenu(pick.primitive.id, movement.position);
                label_timeout = window.setTimeout(function() {
                    featureName.innerHTML = "";
                    featureName.style.visibility = "hidden";
                    context.innerHTML = "";
                    context.style.visibility = "hidden";
                }, 10000);
            }

        }
        else{
            featureName.innerHTML = "";
            featureName.style.visibility = "hidden";
            context.innerHTML = "";
            context.style.visibility = "hidden";
        }
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

    this.handler.setInputAction(function(movement){
        context.innerHTML = "";
        context.style.visibility = "hidden";
    }, Cesium.ScreenSpaceEventType.LEFT_DOWN);

    clearAnalysis();
    getLayers();

    var printedLayerListMenu = document.getElementById('printedLayerListMenu');
    var layer_list = document.getElementById('layer_list');
    var uploadButton = document.getElementById('uploadButton');

    uploadButton.style.padding = "10px";

    var graph = document.getElementById('graph');
    graph.style.visibility = "visible";

    var left_toolbar_btn = document.getElementById('left_toolbar_btn');
    left_toolbar_btn.className = 'btn btn-default';
    left_toolbar_btn.style.left = '14.5%';
    left_toolbar_btn.style.top = '45%';
    left_toolbar_btn.style.width = '15px';
})()
String.prototype.replaceAll = function(org, dest) {
    return this.split(org).join(dest);
}
</script>
</body>

</html>
